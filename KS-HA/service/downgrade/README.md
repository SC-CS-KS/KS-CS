# 服务降级

## When ?
* Client
```md
Server 的成功率
Server 响应时间
```
* Server
```md
Task 的平均处理时间
队列长度
进程消耗的CPU
```

## How ？

* 延长缓存过期时间
```md
记录缓存写入时间，读缓存时读取写入时间 T1，计算缓存存在时长 T = Now - T1。
T1 小于 阈值 则认为未过期，阈值随后端服务的稳定性变化。
```

* 降低计算复杂度
```md
限制数据集范围
重要程度低的逻辑
```
* LIFO
```md
一直在处理旧任务，处理完可能已经超时。
保证新任务的处理，必要情况下丢弃旧任务。
```
* 缩短任务队列过期时间
```md
记录任务放入队列的时间，计算是否过期。
```
* * 如何动态调整过期时间？
```md
任务的凭据响应时间
Client设置的超时时间
当前机器CPU
Task Queue队列长度
```