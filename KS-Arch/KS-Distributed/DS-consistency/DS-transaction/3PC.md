# 3PC
```md
3PC最关键要解决的就是协调者和参与者同时挂掉的问题。
3PC把2PC的准备阶段再次一分为二。
```
## 三个个阶段
* CanCommit
```md
只是询问所有参与者是否可可以执行事务操作，并不在本阶段执行事务操作。
```
* PreCommit
```md
当协调者收到所有的参与者 CanCommit 都返回YES时，在第二阶段才执行事务操作。

* 事务预提交

* 中断事务
```
* DoCommit
```md
第三阶段在执行commit或者rollback。

* 提交事务

* 中断事务

* 注意
进入阶段三后，无论协调者出现问题，或者协调者与参与者网络出现问题，
都会导致参与者无法接收到协调者发出的do Commit请求或abort请求。

此时，参与者都会在等待超时之后，继续执行事务提交。
```
## 优点
```md
降低了阻塞范围，在等待超时后协调者或参与者会中断事务。
避免了协调者单点问题，阶段3中协调者出现问题时，参与者会继续提交事务。
```
## 缺陷
```md
脑裂问题依然存在，即在参与者收到PreCommit请求后等待最终指令，
如果此时协调者无法与参与者正常通信，会导致参与者继续提交事务，造成数据不一致。
```